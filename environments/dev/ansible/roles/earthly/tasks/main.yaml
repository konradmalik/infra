- import_tasks: arch.yaml
  when: ansible_distribution == "Archlinux"

- import_tasks: linux.yaml
  when: ansible_system == "Linux" and ansible_system != "Archlinux"

- import_tasks: osx.yaml
  when: ansible_distribution == "MacOSX"

- name: install asdf earthly plugin
  args:
    executable: /bin/bash
  shell:
    chdir: /tmp
    cmd: |
      . ~/.asdf/asdf.sh && \
      asdf plugin-add earthly https://github.com/YR-ZR0/asdf-earthly && \
      asdf install earthly latest
    creates: ~/.asdf/plugins/earthly

- name: link earthly config
  shell:
    chdir: "{{ repo_path }}/files"
    cmd: stow --target="$HOME" {{ item }}
  with_items:
    - earthly
